# dwg-cli

## DWG Project - Docker WireGuard - CLI (DWG-CLI) - –ü—Ä–æ–µ–∫—Ç –æ–¥–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ 
### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –≤–∞–º –ª—É—á—à—É—é —Å–±–æ—Ä–∫—É –¥–ª—è —Å–∞–º–æ–π –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPN —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ WireGuard
### DWG-CLI = AdGuard with DoH DNS +  Wireguard (CLI) + Unbound 
–¢–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞ –º–æ–µ–º —Ñ–æ—Ä—É–º–µ:
https://openode.ru/topic/140-dwg-cli/

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
* –ß–∏—Å—Ç—ã–π –ø—É—Å—Ç–æ–π —Å–µ—Ä–≤–µ—Ä.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: **Ubuntu 20.04, 22.04; Debian 11, Centos 8,9**

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Å–∫—Ä–∏–ø—Ç—É –≤–Ω—É—Ç—Ä–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö


### [VDSina.ru](https://vdsina.ru/?partner=rwmhc7jbcg) –†–µ–∫–æ–º–µ–Ω–¥—É—é VPS —Ö–æ—Å—Ç–∏–Ω–≥ - –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ —Å–∫–∏–¥–∫–∞ 10%!!!: 	
1. –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–¥–æ 1–≥–±/—Å)
2. –ü–æ—Å—É—Ç–æ—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã
3. –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –º–æ—â–Ω—ã—Ö —Å–±–æ—Ä–æ–∫.
4. –õ–æ—è–ª—å–Ω–æ—Å—Ç—å –∫ VPN –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä–æ–≤.
5. –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å,  ISP –æ—Ç–¥—ã—Ö–∞–µ—Ç.
### [Melbicom](https://melbicom.ru/?from=44619)
–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Å–≤—è–∑—å –≤ 1–≥–±/—Å (–ø—Ä–∏—á–µ–º —Å –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏ –Ω–µ –º–µ–Ω–µ–µ 100–º–±–∏—Ç\—Å)
### [Pq.Hosting](https://pq.hosting/?from=45709)
–í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã –∏ 1–ì–±/—Å
### [Fornex](https://fornex.com/code/jwo1cg/)
–ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ö–æ—Ç–µ–ª –±—ã –æ—Ç–º–µ—Ç–∏—Ç—å —Å–≤–æ—ë –≤–Ω–∏–º–∞–Ω–∏–µ. –ü—Ä–µ—Ç–µ–Ω–∑–∏–π –Ω–µ—Ç, –∫—Ä–æ–º–µ –∫–∞–∫ —Å–∫–æ—Ä–æ—Å—Ç—å 100–º–±–∏—Ç/—Å–µ–∫. (–Ω–æ —Ö–æ—á–µ—Ç—Å—è –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å —ç—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è!)

# –°–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ - 1 –º–∏–Ω—É—Ç–∞

–ó–∞–ø—É—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É –Ω–∞ —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ

```bash
apt update && apt install curl sudo git -y && curl -Of https://raw.githubusercontent.com/DigneZzZ/dwg-cli/main/setup.sh && chmod +x setup.sh && ./setup.sh
```

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥–∞–º:

```bash
chmod +x peer.sh && ./peer.sh
```

## –ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:

0. –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Git, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
1. Docker - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
2. Docker-compose - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
3. Wireguard - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –≤–≤–µ–¥–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–º–µ–Ω–∞\–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
4. AdGuard Home - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—è (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º)
5. Unbound - –≤—Å–µ –≤ —Å—Ç–æ–∫–µ
6. apache2-utils - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ö—ç—à-–ø–∞—Ä–æ–ª–µ–π
7. ssh.sh - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–º–µ–Ω—ã –ø–æ—Ä—Ç–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
8. ufw.sh - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ UFW Firewall.
9. peer.sh - –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–∏—Ä–æ–≤ –∏ –≤—ã–≤–æ–¥–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏


## –ê–≤—Ç–æ—Ä:

üë§ ** Alexey **
* Git: [DigneZzZ](https://github.com/DigneZzZ)
* Site: [OpeNode.RU](https://openode.ru)

## –°–∫—Ä–∏–Ω—à–æ—Ç—ã
### peer.sh
![image](https://user-images.githubusercontent.com/50312583/228484202-5de1ebbd-e816-4248-b03a-cd43ead8a22d.png)


### Adguard Web-UI
![image](https://user-images.githubusercontent.com/50312583/206703207-f3bd39f1-72c7-458c-9893-ad2126a0d47b.png)



## –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### AdGuard HOME 
#### –ó–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏ WG:
http://agh.local/  

### Login: **admin** 
### Password: **admin**


## –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Adlists –¥–ª—è –†—É–Ω–µ—Ç–∞ –≤ —Ç–æ–º —á–∏—Å–ª–µ:
* RU-Adlist
https://easylist-downloads.adblockplus.org/advblock.txt
* BitBlock
https://easylist-downloads.adblockplus.org/bitblock.txt
* Cntblock
https://easylist-downloads.adblockplus.org/cntblock.txt
* EasyList
https://easylist-downloads.adblockplus.org/easylist.txt
* –î–æ–ø —Å–ø–∏—Å–æ–∫ –æ—Ç –®–∞–∫–∞–ª–∞
https://schakal.ru/hosts/alive_hosts_ru_com.txt
* —Ñ–∞–π–ª —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ r.mail.ru –∏ graph.facebook.com
https://schakal.ru/hosts/hosts_mail_fb.txt
---
* All DNS Servers
https://adguard-dns.io/kb/general/dns-providers/#cloudflare-dns
* DNS Perfomance list:
https://www.dnsperf.com/#!dns-resolvers

---
## Configuring / Parameters

Container images are configured using parameters passed at runtime (such as those above). These parameters are separated by a colon and indicate `<external>:<internal>` respectively. For example, `-p 8080:80` would expose port `80` from inside the container to be accessible from the host's IP on port `8080` outside the container.

| Parameter | Function |
| :----: | --- |
| `-p 51820/udp` | wireguard port |
| `-e PUID=1000` | for UserID - see below for explanation |
| `-e PGID=1000` | for GroupID - see below for explanation |
| `-e TZ=Europe/London` | Specify a timezone to use EG Europe/London |
| `-e SERVERURL=wireguard.domain.com` | External IP or domain name for docker host. Used in server mode. If set to `auto`, the container will try to determine and set the external IP automatically |
| `-e SERVERPORT=51820` | External port for docker host. Used in server mode. |
| `-e PEERS=1` | Number of peers to create confs for. Required for server mode. Can be a list of names too: myPC,myPhone,myTablet... |
| `-e PEERDNS=auto` | DNS server set in peer/client configs (can be set as `8.8.8.8`). Used in server mode. Defaults to `auto`, which uses wireguard docker host's DNS via included CoreDNS forward. |
| `-e INTERNAL_SUBNET=10.13.13.0` | Internal subnet for the wireguard and server and peers (only change if it clashes). Used in server mode. |
| `-e ALLOWEDIPS=0.0.0.0/0` | The IPs/Ranges that the peers will be able to reach using the VPN connection. If not specified the default value is: '0.0.0.0/0, ::0/0' This will cause ALL traffic to route through the VPN, if you want split tunneling, set this to only the IPs you would like to use the tunnel AND the ip of the server's WG ip, such as 10.13.13.1. |
| `-v /config` | Contains all relevant configuration files. |
| `-v /lib/modules` | Maps host's modules folder. |
| `--sysctl=` | Required for client mode. |

### Environment variables from files (Docker secrets)

You can set any environment variable from a file by using a special prepend `FILE__`.

As an example:

```bash
-e FILE__PASSWORD=/run/secrets/mysecretpassword
```

Will set the environment variable `PASSWORD` based on the contents of the `/run/secrets/mysecretpassword` file.

### Umask for running applications

There is the ability to override the default umask settings for services started within the containers using the optional `-e UMASK=022` setting.
Keep in mind umask is not chmod it subtracts from permissions based on it's value it does not add. Please read up [here](https://en.wikipedia.org/wiki/Umask) before asking for support.

### User / Group Identifiers

When using volumes (`-v` flags) permissions issues can arise between the host OS and the container, this is avoided by allowing you to specify the user `PUID` and group `PGID`.

Ensure any volume directories on the host are owned by the same user you specify and any permissions issues will vanish like magic.

In this instance `PUID=1000` and `PGID=1000`, to find yours use `id user` as below:

```bash
  $ id username
    uid=1000(dockeruser) gid=1000(dockergroup) groups=1000(dockergroup)
```

---

## Adding Clients
If the environment variable `PEERS` is set to a number or a list of strings separated by comma, the container will run in server mode and the necessary server and peer/client confs will be generated. The peer/client config qr codes will be output in the docker log. They will also be saved in text and png format under `/config/peerX` in case `PEERS` is a variable and an integer or `/config/peer_X` in case a list of names was provided instead of an integer.

Variables `SERVERURL`, `SERVERPORT`, `INTERNAL_SUBNET` and `PEERDNS` are optional variables used for server mode. Any changes to these environment variables will trigger regeneration of server and peer confs. Peer/client confs will be recreated with existing private/public keys. Delete the peer folders for the keys to be recreated along with the confs.

To add more peers/clients later on, you increment the `PEERS` environment variable or add more elements to the list and recreate the container.

To display the QR codes of active peers again, you can use the following command and list the peer numbers as arguments: `docker exec -it wireguard /app/show-peer 1 4 5` or `docker exec -it wireguard /app/show-peer myPC myPhone myTablet` (Keep in mind that the QR codes are also stored as PNGs in the config folder).

The templates used for server and peer confs are saved under `/config/templates`. Advanced users can modify these templates and force conf generation by deleting `/config/wg0.conf` and restarting the container.

*(This portion of documentation has been adapted from [docker-wireguard](https://github.com/linuxserver/docker-wireguard/blob/master/README.md))*

---

## Modifying the upstream DNS provider for Unbound
If you choose to not use Cloudflare any reason you are able to modify the upstream DNS provider in `unbound.conf`.

Search for `forward-zone` and modify the IP addresses for your chosen DNS provider.

>**NOTE:** The anything after `#` is a comment on the line. 
What this means is it is just there to tell you which DNS provider you put there. It is for you to be able to reference later. I recommend updating this if you change your DNS provider from the default values.


```yaml
forward-zone:
        name: "."
        forward-addr: 1.1.1.1@853#cloudflare-dns.com
        forward-addr: 1.0.0.1@853#cloudflare-dns.com
        forward-addr: 2606:4700:4700::1111@853#cloudflare-dns.com
        forward-addr: 2606:4700:4700::1001@853#cloudflare-dns.com
        forward-tls-upstream: yes
```

---

## FAQ

### How do you add client configurations?
If the environment variable `PEERS` is set to a number, the container will run in server mode and the necessary server and peer/client confs will be generated. The peer/client config qr codes will be output in the docker log. They will also be saved in text and png format under /config/peerX.

Variables `SERVERURL`, `SERVERPORT`, `INTERNAL_SUBNET` and `PEERDNS` are optional variables used for server mode. Any changes to these environment variables will trigger regeneration of server and peer confs. Peer/client confs will be recreated with existing private/public keys. Delete the peer folders for the keys to be recreated along with the confs.

To add more peers/clients later on, you increment the `PEERS` environment variable and recreate the container.

To display the QR codes of active peers again, you can use the following command and list the peer numbers as arguments: `docker-compose exec wireguard /app/show-peer 1 4 5` will show peers #1 #4 and #5 (Keep in mind that the QR codes are also stored as PNGs in the config folder).

The templates used for server and peer confs are saved under /config/templates. Advanced users can modify these templates and force conf generation by deleting /config/wg0.conf and restarting the container.

